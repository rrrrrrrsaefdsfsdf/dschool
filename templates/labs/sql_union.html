{% extends "base.html" %}
{% block title %}–õ–∞–±–∞: UNION SQL –∏–Ω—ä–µ–∫—Ü–∏—è{% endblock %}
{% block content %}
<link rel="stylesheet" href="{{ url_for('static', filename='lab-styles.css') }}">
<div class="lab-wrapper">
    <div class="lab-header lab-union-header">
        <h1>üîç UNION SQL –ò–Ω—ä–µ–∫—Ü–∏—è</h1>
        <p>{{ lab.description if lab else "–ò–∑–≤–ª–µ–∫–∏—Ç–µ —Å–∫—Ä—ã—Ç—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ –±–∞–∑—ã –∏—Å–ø–æ–ª—å–∑—É—è —Ç–µ—Ö–Ω–∏–∫—É UNION SELECT" }}</p>
    </div>
    <div class="lab-container">
        <div class="row">
            <div class="col-lg-8">
                <div class="lab-search-box">
                    <form method="POST" class="lab-search-form">
                        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
                        <input type="text" name="search" class="lab-search-input"
                               placeholder="–ü–æ–∏—Å–∫ —Ç–æ–≤–∞—Ä–æ–≤ –≤ –∫–∞—Ç–∞–ª–æ–≥–µ..." value="{{ search if search else '' }}">
                        <button type="submit" class="lab-btn lab-btn-search">
                            <i class="fas fa-search me-2"></i>–ù–∞–π—Ç–∏ —Ç–æ–≤–∞—Ä—ã
                        </button>
                    </form>
                </div>
                {% if error %}
                    <div class="lab-error-alert">
                        <i class="fas fa-exclamation-triangle me-2"></i>{{ error }}
                    </div>
                {% endif %}
                {% if query %}
                    <div class="lab-sql-output">
                        <div style="font-size: 0.75rem; margin-bottom: 0.5rem; opacity: 0.7;">–í–´–ü–û–õ–ù–ï–ù–ù–´–ô SQL –ó–ê–ü–†–û–°</div>
                        <code>{{ query }}</code>
                    </div>
                {% endif %}
                {% if results %}
                    <div class="lab-content-card">
                        <table class="lab-results-table">
                            <thead>
                                <tr>
                                    <th>–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞</th>
                                    <th>–û–ø–∏—Å–∞–Ω–∏–µ</th>
                                    <th>–¶–µ–Ω–∞</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for row in results %}
                                <tr>
                                    <td>
                                        {% if row[0] and 'FLAG' in str(row[0]) %}
                                            <span class="lab-flag-found">üèÅ {{ row[0] }}</span>
                                        {% else %}
                                            {{ row[0] if row[0] else '' }}
                                        {% endif %}
                                    </td>
                                    <td>
                                        {% if row[1] and 'FLAG' in str(row[1]) %}
                                            <span class="lab-flag-found">üèÅ {{ row[1] }}</span>
                                        {% else %}
                                            {{ row[1] if row[1] else '' }}
                                        {% endif %}
                                    </td>
                                    <td>
                                        {% if row[2] and 'FLAG' in str(row[2]) %}
                                            <span class="lab-flag-found">üèÅ {{ row[2] }}</span>
                                        {% else %}
                                            {% if row[2] %}{{ row[2] }} —Ä—É–±.{% endif %}
                                        {% endif %}
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                {% elif search %}
                    <div class="lab-content-card">
                        <div class="lab-info-alert">
                            <i class="fas fa-info-circle me-2"></i>–ü–æ –∑–∞–ø—Ä–æ—Å—É "{{ search }}" –Ω–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ
                        </div>
                    </div>
                {% endif %}
            </div>
            <div class="col-lg-4">
                <div class="lab-content-card">
                    <h5 class="mb-3">üìö –≠—Ç–∞–ø—ã –∞—Ç–∞–∫–∏</h5>
                    <div class="lab-step-card" data-step="1">
                        <div class="lab-step-title">–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∫–æ–ª–æ–Ω–æ–∫</div>
                        <div class="lab-step-text">–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ <code>ORDER BY</code> –¥–ª—è –ø–æ–¥—Å—á–µ—Ç–∞ —Å—Ç–æ–ª–±—Ü–æ–≤</div>
                    </div>
                    <div class="lab-step-card" data-step="2">
                        <div class="lab-step-title">–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ UNION</div>
                        <div class="lab-step-text">–ü–æ–ø—Ä–æ–±—É–π—Ç–µ <code>' UNION SELECT 1,2,3--</code></div>
                    </div>
                    <div class="lab-step-card" data-step="3">
                        <div class="lab-step-title">–ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö</div>
                        <div class="lab-step-text">–°–¥–µ–ª–∞–π—Ç–µ –∑–∞–ø—Ä–æ—Å –∫ —Ç–∞–±–ª–∏—Ü–µ <code>flags</code></div>
                    </div>
                    <div class="lab-step-card" data-step="4" style="border-left-color: #10b981;">
                        <div class="lab-step-title">–ü–æ–ª—É—á–µ–Ω–∏–µ —Ñ–ª–∞–≥–∞</div>
                        <div class="lab-step-text"><code>' UNION SELECT flag_value,'—Å–µ–∫—Ä–µ—Ç',0 FROM flags--</code></div>
                    </div>
                </div>
                <div class="lab-content-card">
                    <h5 class="mb-3">üóÑÔ∏è –°—Ö–µ–º–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö</h5>
                    <div class="lab-table-schema">
                        <strong>products (—Ç–æ–≤–∞—Ä—ã)</strong><br>
                        ‚îú‚îÄ id, name, description, price
                    </div>
                    <div class="lab-table-schema">
                        <strong>users (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏)</strong><br>
                        ‚îú‚îÄ id, username, password, role
                    </div>
                    <div class="lab-table-schema lab-flag-table">
                        <strong>flags (—Ñ–ª–∞–≥–∏)</strong> üèÅ<br>
                        ‚îú‚îÄ id, flag_name, flag_value
                    </div>
                </div>
                <div class="lab-content-card">
                    <h5 class="mb-3">‚ö° –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã</h5>
                    <div class="lab-info-alert">
                        <strong>–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∫–æ–ª–æ–Ω–æ–∫:</strong>
                        <code>' ORDER BY 1--</code>, <code>' ORDER BY 2--</code>
                    </div>
                    <div class="lab-warning-alert">
                        <strong>–ë–∞–∑–æ–≤—ã–π UNION:</strong>
                        <code>' UNION SELECT NULL,NULL,NULL--</code>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}