{% extends "base.html" %}
{% block title %}–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ ‚Äî {{ lab.title }}{% endblock %}
{% block content %}
<div class="container mt-4">
    <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="{{ url_for('dashboard') }}">–ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è</a></li>
            <li class="breadcrumb-item"><a href="{{ url_for('admin.admin_labs') }}">–õ–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω—ã–µ —Ä–∞–±–æ—Ç—ã</a></li>
            <li class="breadcrumb-item active">–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏</li>
        </ol>
    </nav>

    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2>üìã –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–ª—è –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–æ–π</h2>
        <a class="btn btn-success" href="{{ url_for('admin.admin_lab_instruction_new', lab_id=lab.id) }}">
            <i class="fas fa-plus"></i> –î–æ–±–∞–≤–∏—Ç—å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é
        </a>
    </div>

    <div class="card mb-4">
        <div class="card-header bg-light">
            <h5 class="mb-0">üß™ {{ lab.title }}</h5>
        </div>
        <div class="card-body">
            <p class="mb-1"><strong>–û–ø–∏—Å–∞–Ω–∏–µ:</strong> {{ lab.description }}</p>
            <p class="mb-1"><strong>–°–ª–æ–∂–Ω–æ—Å—Ç—å:</strong> 
                <span class="badge bg-{{ 'success' if lab.difficulty == '–õ–µ–≥–∫–æ' else 'warning' if lab.difficulty == '–°—Ä–µ–¥–Ω–µ' else 'danger' }}">
                    {{ lab.difficulty }}
                </span>
            </p>
            <p class="mb-0"><strong>–≠–Ω–¥–ø–æ–∏–Ω—Ç:</strong> <code>{{ lab.endpoint }}</code></p>
        </div>
    </div>

    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            {% for category, message in messages %}
                <div class="alert alert-{{ 'success' if category == 'success' else 'danger' if category == 'error' else category }} alert-dismissible fade show">
                    {{ message }}
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>
            {% endfor %}
        {% endif %}
    {% endwith %}

    {% if instructions %}
        <div class="row">
            {% for instruction in instructions %}
            <div class="col-md-6 mb-3">
                <div class="card h-100">
                    <div class="card-header bg-{{ 'info' if instruction.instruction_type == 'before_start' else 'success' if instruction.instruction_type == 'after_solve' else 'warning' if instruction.instruction_type == 'flag_format' else 'primary' }} text-white">
                        <div class="d-flex justify-content-between align-items-center">
                            <h6 class="mb-0">
                                {% if instruction.instruction_type == 'before_start' %}
                                    üìù –ü–µ—Ä–µ–¥ –Ω–∞—á–∞–ª–æ–º —Ä–∞–±–æ—Ç—ã
                                {% elif instruction.instruction_type == 'after_solve' %}
                                    ‚úÖ –ü–æ—Å–ª–µ —Ä–µ—à–µ–Ω–∏—è
                                {% elif instruction.instruction_type == 'flag_format' %}
                                    üèÅ –§–æ—Ä–º–∞—Ç —Ñ–ª–∞–≥–∞
                                {% elif instruction.instruction_type == 'flag_instruction' %}
                                    üí° –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ —Ñ–ª–∞–≥—É
                                {% else %}
                                    {{ instruction.instruction_type }}
                                {% endif %}
                            </h6>
                            <div class="btn-group btn-group-sm">
                                <a href="{{ url_for('admin.admin_lab_instruction_edit', lab_id=lab.id, instruction_id=instruction.id) }}" 
                                   class="btn btn-sm btn-light">
                                    <i class="fas fa-edit"></i>
                                </a>
                                <form method="post" 
                                      action="{{ url_for('admin.admin_lab_instruction_delete', lab_id=lab.id, instruction_id=instruction.id) }}" 
                                      style="display:inline-block;" 
                                      onsubmit="return confirm('–£–¥–∞–ª–∏—Ç—å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é?');">
                                    {{ csrf_token() }}
                                    <button type="submit" class="btn btn-sm btn-light">
                                        <i class="fas fa-trash text-danger"></i>
                                    </button>
                                </form>
                            </div>
                        </div>
                    </div>
                    <div class="card-body">
                        <p class="mb-0">{{ instruction.content }}</p>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    {% else %}
        <div class="card">
            <div class="card-body text-center py-5">
                <h5>üìã –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–π –ø–æ–∫–∞ –Ω–µ—Ç</h5>
                <p class="text-muted">–î–æ–±–∞–≤—å—Ç–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–ª—è —ç—Ç–æ–π –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–æ–π —Ä–∞–±–æ—Ç—ã.</p>
                <a href="{{ url_for('admin.admin_lab_instruction_new', lab_id=lab.id) }}" class="btn btn-success">
                    <i class="fas fa-plus"></i> –î–æ–±–∞–≤–∏—Ç—å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é
                </a>
            </div>
        </div>
    {% endif %}

    <div class="mt-4 alert alert-info">
        <h6>‚ÑπÔ∏è –¢–∏–ø—ã –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π:</h6>
        <ul class="mb-0">
            <li><strong>–ü–µ—Ä–µ–¥ –Ω–∞—á–∞–ª–æ–º —Ä–∞–±–æ—Ç—ã</strong> ‚Äî –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –ø–µ—Ä–µ–¥ –∫–Ω–æ–ø–∫–æ–π –∑–∞–ø—É—Å–∫–∞ –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–æ–π</li>
            <li><strong>–ü–æ—Å–ª–µ —Ä–µ—à–µ–Ω–∏—è</strong> ‚Äî –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–ª–∞–≥–∞</li>
            <li><strong>–§–æ—Ä–º–∞—Ç —Ñ–ª–∞–≥–∞</strong> ‚Äî placeholder –¥–ª—è –ø–æ–ª—è –≤–≤–æ–¥–∞ —Ñ–ª–∞–≥–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä: FLAG{...})</li>
            <li><strong>–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ —Ñ–ª–∞–≥—É</strong> ‚Äî —Ç–µ–∫—Å—Ç –ø–æ–¥ –ø–æ–ª–µ–º –≤–≤–æ–¥–∞ —Ñ–ª–∞–≥–∞</li>
        </ul>
    </div>

    <div class="mt-4">
        <a href="{{ url_for('admin.admin_labs') }}" class="btn btn-secondary">
            <i class="fas fa-arrow-left"></i> –ù–∞–∑–∞–¥ –∫ –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–∏—è–º
        </a>
        <a href="{{ url_for('admin.admin_lab_hints', lab_id=lab.id) }}" class="btn btn-info">
            <i class="fas fa-lightbulb"></i> –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–¥—Å–∫–∞–∑–∫–∞–º–∏
        </a>
    </div>
</div>
{% endblock %}